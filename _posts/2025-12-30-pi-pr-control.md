---
layout:     post
title:      "深入理解电源控制：PI 与 PR 控制器详解"
subtitle:   "从传递函数到代码实现，解析两种主流控制算法的优劣与应用"
date:       2025-12-30 12:00:00
author:     "Pigeon"
header-img: "img/post-bg-2015.jpg"
tags:
    - Control Theory
    - Power Electronics
    - STM32
---

> 在电力电子与电机控制领域，控制器的选择直接决定了系统的稳态精度与动态性能。作为通信工程与嵌入式方向的学生，理解 PI（比例积分）与 PR（比例谐振）控制器的本质区别，是掌握逆变器、整流器以及电机驱动技术的关键。

## 1. 为什么要研究传递函数？

在经典控制理论中，**传递函数 (Transfer Function)** 描述了线性时不变系统 (LTI) 输入与输出之间的关系。对于电源控制系统，我们的目标通常是让输出电压或电流无静差地跟踪参考信号。

根据 **内模原理 (Internal Model Principle)**：如果控制器包含参考信号的数学模型，那么闭环系统就能实现对该参考信号的无静差跟踪。

*   **DC 信号 (0Hz)**：模型是 $1/s$ (积分器)。
*   **AC 正弦信号 ($\omega_0$)**：模型是 $s/(s^2 + \omega_0^2)$ (谐振器)。

这就是 PI 和 PR 控制器诞生的理论基础。

---

## 2. PI 控制器 (Proportional Integral)

PI 控制器是最常见的控制器，广泛应用于各种工业控制场合。

### 2.1 传递函数

连续域下的传递函数为：

$$ G_{PI}(s) = K_p + \frac{K_i}{s} $$

其中：
*   $K_p$：比例系数，负责快速响应。
*   $K_i$：积分系数，负责消除稳态误差。

### 2.2 特性分析

*   **直流增益**：当 $s \to 0$ 时，$|G_{PI}(j\omega)| \to \infty$。这意味着 PI 控制器在直流频率处具有无穷大的增益。
*   **交流特性**：随着频率增加，积分作用减弱，增益下降。

### 2.3 优缺点与应用

*   **优点**：算法简单，参数易整定，鲁棒性强。
*   **缺点**：**无法无静差地跟踪正弦量**。对于交流信号，PI 控制器只能提供有限增益，因此必然存在幅值误差和相位滞后。
*   **应用**：DC-DC 变换器、FOC 控制中的 $d-q$ 轴电流控制（因为在旋转坐标系下，交流量变成了直流量）。

---

## 3. PR 控制器 (Proportional Resonant)

为了解决 PI 控制器无法跟踪交流信号的问题，PR 控制器被引入。它在特定的谐振频率处提供无穷大的增益。

### 3.1 传递函数

理想 PR 控制器的传递函数为：

$$ G_{PR}(s) = K_p + \frac{2 K_r s}{s^2 + \omega_0^2} $$

但在实际应用中，为了增加系统的稳定性（避免无限增益导致的振荡）和对频率波动的适应性，通常使用 **准谐振 (Quasi-PR)** 控制器：

$$ G_{QPR}(s) = K_p + \frac{2 K_r \omega_c s}{s^2 + 2 \omega_c s + \omega_0^2} $$

其中：
*   $K_p$：比例系数。
*   $K_r$：谐振系数，决定谐振峰的增益大小。
*   $\omega_0$：谐振角频率（例如电网频率 $2\pi \times 50$ rad/s）。
*   $\omega_c$：截止频率（带宽），决定了谐振峰的宽度。

### 3.2 频率响应对比 (Bode 图)

下图展示了 PI 控制器与 PR 控制器的幅频特性对比：

![PI vs PR Bode Plot](/img/post-control/pi-pr-bode.svg)
*(图片来源: 自制示意图)*

可以看到，PR 控制器在 $\omega_0$ 处有一个尖峰，增益极大，从而实现了对该频率信号的无静差跟踪。

### 3.3 离散化 (C语言实现准备)

要在 STM32 等数字芯片上实现 PR 控制，需要将其离散化。通常采用 **双线性变换 (Tustin变换)**：
$$ s = \frac{2}{T_s} \frac{1-z^{-1}}{1+z^{-1}} $$

代入准 PR 公式并整理，可以得到差分方程：
$$ y[n] = b_0 x[n] + b_1 x[n-1] + b_2 x[n-2] - a_1 y[n-1] - a_2 y[n-2] $$

*(具体的系数计算比较繁琐，通常使用 MATLAB 的 `c2d` 函数辅助计算)*

### 3.4 优缺点与应用

*   **优点**：能实现对特定频率正弦信号的**零稳态误差**跟踪；抗干扰能力强（针对特定频率）。
*   **缺点**：计算量比 PI 大；对频率敏感（如果电网频率偏移，增益会急剧下降，需要自适应调整 $\omega_0$）；参数整定相对复杂。
*   **应用**：光伏逆变器（并网电流控制）、有源电力滤波器 (APF)、单相整流器。

---

## 4. 总结：该选哪一个？

| 特性 | PI 控制器 | PR 控制器 |
| :--- | :--- | :--- |
| **控制对象** | 直流量 (DC) | 交流量 (AC) |
| **静差** | DC 无静差，AC 有静差 | 特定频率 AC 无静差 |
| **坐标系** | 旋转坐标系 (dq) | 静止坐标系 ($\alpha\beta$) |
| **计算量** | 小 | 中等 |
| **典型场景** | 电机 FOC、开关电源 | 并网逆变器 |

在实际的电源设计中，如果你在做 **三相并网逆变器**，你可以选择：
1.  **PI 控制**：先通过 Park 变换把三相交流电 ($abc$) 变成旋转直流电 ($dq$)，然后用 PI 控制。
2.  **PR 控制**：直接在静止坐标系 ($\alpha\beta$) 下，对交流分量进行 PR 控制，省去了 Park 变换，但需要实现谐振算法。

希望这篇文章能帮你理清这两个控制器的核心区别！
